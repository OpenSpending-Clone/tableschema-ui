<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<title>tableschema-ui</title>
<body>

  <!-- Form -->
  <div class="container" style="padding: 1em">
    <div id="ckan-side" style="opacity: 0.75; color: #777; border: solid 5px #eee; maring-bottom: 3em; padding: 2em; background-color: #fafafa; border-radius: 0.5em">
      <h4>Demo CKAN side</h4>
      <hr />
      <div class="row">
        <div class="col-md">
          <div class="form-group">
            <label for="">File</label>
            <div class="input-group">
              <label class="custom-file-label" for="inputGroupFile01">Upload file</label>
              <input id="source-file" class="custom-file-input" type="file" id="inputGroupFile01" placeholder="upload"/>
              <input id="source-link" class="form-control" type="text" placeholder="Provide link"/>
            </div>
          </div>
          <div class="form-group">
            <label for="">Data Schema</label>
            <div class="input-group">
              <label class="custom-file-label" for="inputGroupFile02">Upload file</label>
              <input id="schema-file" class="custom-file-input" type="file" id="inputGroupFile02" placeholder="upload"/>
              <div class="input-group">
                <input id="schema-link" class="form-control" type="text" placeholder="Provide link"/>
                <input id="schema-json" class="form-control" type="text" placeholder="Provide JSON"/>
                <div class="input-group-append">
                  <button id="schema-edit" class="btn">Edit</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md">
          <label for="">Output</label>
          <pre id="schema-output" style="width: 100%; height: 14em; overflow:vertical-scroll; background-color: white; border: solid 1px #ddd;">
          </pre>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document" style="max-width: 75%;">
      <div class="modal-content">
        <div style="position: absolute; right: 1em; top: 1em; z-index: 100;">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div>
        <div class="modal-body">
          <div id="editor-schema"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="//code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script src="//unpkg.com/tableschema-ui/dist/tableschema-ui.min.js"></script>
  <script src="/dist/tableschema-ui.js"></script>
  <script>
    let schemaEditor = false
    $('#schema-edit').click(() => {
      const component = tableschemaUI.EditorSchema
      const element = document.getElementById('editor-schema')
      const source = ($('#source-file').prop('files') || [])[0] || $('#source-link').val()
      const schema = ($('#schema-file').prop('files') || [])[0] || $('#schema-link').val() || JSON.parse($('#schema-json').val() || 'null')
      const onSave = (schema, error) => {
        if (!error) $('#schema-output').html(JSON.stringify(schema, null, 2))
        $('#modal').modal('hide')
      }
      $('#modal').modal('show')
      if (!schemaEditor) {
        tableschemaUI.render(component, {source, schema, onSave}, element)
        schemaEditor = true
      }
    })
  </script>

</body>
